<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter [
<!-- Some useful entities borrowed from HTML -->
<!ENTITY ndash  "&#x2013;">
<!ENTITY mdash  "&#x2014;">
<!ENTITY hellip "&#x2026;">

<!-- Useful for describing APIs -->
<!ENTITY GET    '<command xmlns="http://docbook.org/ns/docbook">GET</command>'>
<!ENTITY PUT    '<command xmlns="http://docbook.org/ns/docbook">PUT</command>'>
<!ENTITY POST   '<command xmlns="http://docbook.org/ns/docbook">POST</command>'>
<!ENTITY DELETE '<command xmlns="http://docbook.org/ns/docbook">DELETE</command>'>

<!ENTITY CHECK  '<inlinemediaobject xmlns="http://docbook.org/ns/docbook">
<imageobject>
<imagedata fileref="img/Check_mark_23x20_02.svg"
format="SVG" scale="60"/>
</imageobject>
</inlinemediaobject>'>

<!ENTITY ARROW  '<inlinemediaobject xmlns="http://docbook.org/ns/docbook">
<imageobject>
<imagedata fileref="img/Arrow_east.svg"
format="SVG" scale="60"/>
</imageobject>
</inlinemediaobject>'>
]>
<chapter xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="ch_object-storage-dev-troubleshooting">
    <title>Troubleshooting and Examples</title>
    <para>This section introduces a command-line utility, cURL, and demonstrates interacting with the ReST
        interfaces through that utility.</para>
    <section xml:id="using-curl-cli">
        <title>Using cURL</title>
        <para>cURL is a command-line tool which is available on most UNIX®-like environments and Mac
            OS X® and can be downloaded for Windows®. For more information on cURL, visit <link
                xlink:href="http://curl.haxx.se/">http://curl.haxx.se/</link>. </para>
        <para>cURL allows you to transmit and receive HTTP requests and responses from the
            command-line or from within a shell script. This makes it possible to work with the ReST API
            directly without using one of the client APIs. </para>
        <para>The following cURL command-line options will be used</para>
        <variablelist>
            <title>cURL Command-Line Options</title>
            <varlistentry>
                <term><option>-X METHOD</option></term>
                <listitem>
                    <para>Specify the HTTP method to request (<code>HEAD</code>, &GET;,
                        etc.)</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><option>-D</option></term>
                <listitem>
                    <para>Dump HTTP response headers to stdout.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term><option>-H HEADER</option></term>
                <listitem>
                    <para>Specify an HTTP header in the request.</para>
                </listitem>
            </varlistentry>
        </variablelist>
    </section>
        <section xml:id="authentication-examples-curl">
        <title>Authentication</title>
        <para>In order to use the ReST API, you will first need to obtain a authorization token,
            which will need to be passed in for each request using the <code>X-Auth-Token</code>
            header. The following example demonstrates how to use cURL to obtain the authorization
            token and the URL of the storage system.</para>
        <example>
            <title>cURL Authenticate</title>
            <screen>
<command>curl</command> <option>-D</option> - \
    <option>-H "X-Auth-Key: jdoesecretpassword"</option> \
    <option>-H "X-Auth-User: jdoe"</option> \
    <uri>https://auth.api.yourcloud.com/v1.0</uri>
                  </screen>
            <screen>
<computeroutput>
HTTP/1.1 204 No Content
Date: Thu, 09 Jul 2009 15:31:39 GMT
Server: Apache/2.2.3
X-Storage-Url: https://storage.swiftdrive.com/v1/CF_xer7_343
X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae
Content-Length: 0
Connection: close
Content-Type: application/octet-stream
</computeroutput>
			</screen>
        </example>
        <para>The storage URL and authentication token are returned in
            the headers of the response. After authentication, you can use cURL to perform
            <code>HEAD</code>, &GET;, &DELETE;, &POST; and &PUT; requests on the storage
            service.</para>
    </section>
    <section xml:id="determining-storage-useage">
        <title>Determining Storage Usage</title>
        <para>A <code>HEAD</code> request can be sent to the storage service to determine how much
            data you have stored in the system and the number of containers you are using. Use the
            <code>-X</code> switch to specify the correct HTTP method and the <code>-D</code> to
            dump the HTTP response headers to terminal output (stdout).</para>
        <example>
            <title>cURL Get Storage Space</title>
            <screen>
<command>curl</command> <option>–X HEAD</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343</uri>
                  </screen>
            <screen>
<computeroutput>
HTTP/1.1 204 No Content
Date: Thu, 09 Jul 2009 15:38:14 GMT
Server: Apache
X-Account-Container-Count: 22
X-Account-Bytes-Used: 9891628380
Content-Type: text/plain
</computeroutput>
		</screen>
        </example>
        <para>The HTTP request must include a header to specify the authentication token. The HTTP
            headers in the response indicate the number of containers in this storage account and the
            total bytes stored for the entire account.</para>
    </section>
    <section xml:id="listing-and-creating-storage-containers">
        <title>Listing and creating containers</title>
        <para> The simplest operation for Object Storage is to simply list the containers you have, which when you don't have any containers yet isn't terribly exciting:</para>
        <example>
            <title>cURL List Storage Container</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 204 No Content
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 0
Accept-Ranges: bytes
X-Trans-Id: txe8ca5138ac8643ec84070543a0c9c91e
Content-Length: 0
Date: Mon, 07 Nov 2011 17:07:01 GMT
</computeroutput>
		</screen>
        </example>
        <para>So, you take the X-Auth-Token obtained from the authentication operation, pass it as a header value, execute the operation against the URL obtained from the authentication operation, and force the GET verb with the -X switch.  What you get back tells you there aren't any containers.</para>
        <para>Next, let's create a container and then do the listing again:</para>
		<example>
            <title>cURL Create Storage Container</title>
            <screen>
<command>curl</command> <option>–X PUT</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343/george</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 201 Created
Content-Length: 18
Content-Type: text/html; charset=UTF-8
X-Trans-Id: txb25576385284476d9fa6c73835f21650
Date: Mon, 07 Nov 2011 17:44:20 GMT

201 Created
</computeroutput>
			</screen>
        </example>
		<para>Append the container name to the URL and force the PUT verb.  That creates a container, which we can now see when we do a listing:</para>
        <example>
            <title>cURL List Storage Container After a Creation</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 1
Accept-Ranges: bytes
Content-Length: 7
Content-Type: text/plain; charset=utf-8
X-Trans-Id: txaedd6b080626453399c9f5febbddb73b
Date: Mon, 07 Nov 2011 17:44:23 GMT

george
</computeroutput>
			</screen>
        </example>
		<para>You may have noticed the account metadata that comes back from the listing call.  As you'd guess, it'll tell you how many objects you have, how much space you are using, and how many containers you are using.</para>
    </section>
    <section xml:id="paging-container-lists">
        <title>Paging long list of containers</title>
        <para>If you have a large number of containers, it is sometimes more convenient to page through them than getting some big long list of them.  If I create more containers and then do a regular listing, here's what it looks like with five containers:</para>
        <example>
            <title>cURL List Storage Container (long list)</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 5
Accept-Ranges: bytes
Content-Length: 31
Content-Type: text/plain; charset=utf-8
X-Trans-Id: txb28795cc25b04f0dbce408dfa5a3cfc9
Date: Mon, 07 Nov 2011 19:03:06 GMT

cosmo
dogs
elaine
george
jerry
</computeroutput>
		</screen>
        </example>
        <para>Suppose I want a page size of 2, all I do is append a ""?limit=2"" to my URL:</para>
		<example>
            <title>cURL List Storage Container with Paging (first page)</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343?limit=2</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 5
Accept-Ranges: bytes
Content-Length: 11
Content-Type: text/plain; charset=utf-8
X-Trans-Id: tx940ee02c1a65451e96a2a2532e3a7ce7
Date: Mon, 07 Nov 2011 19:05:30 GMT

cosmo
dogs
</computeroutput>
			</screen>
        </example>
		<para>Not surprisingly, I only get two containers.  To get the next page, you tell the system which item you last saw with the "marker=" specifier:</para>
        <example>
            <title>cURL List Storage Container with Paging (later pages)</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343?marker=dogs\&amp;limit=2</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 5
Accept-Ranges: bytes
Content-Length: 14
Content-Type: text/plain; charset=utf-8
X-Trans-Id: tx2a69f7ec38c34078a185c5875a4c0e34
Date: Mon, 07 Nov 2011 19:15:00 GMT

elaine
george
</computeroutput>
			</screen>
        </example>
		<para>Notice that I had to use \&amp; so that my bash shell didn't try to interpret the &amp; as wanting to run something in its own thread.  With that in place, you get the next page of items that appear after the marker.</para>
	</section>
    <section xml:id="serialized-output">
        <title>Serialized Output</title>
        <para>In other situations, like if you are working on a language binding on top of the REST API, you might want more structured data back from the method calls.  By appending a "format=" and then choosing either json or xml, you can get that structured data back you've been dreaming about.</para>
        <example>
            <title>cURL List Storage Container (JSON output)</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343?format=json</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 5
Accept-Ranges: bytes
Content-Length: 187
Content-Type: application/json; charset=utf-8
X-Trans-Id: txd408573a51d2423c848cba191fbede9b
Date: Mon, 07 Nov 2011 19:17:33 GMT

[{"name":"cosmo", "count":0,"bytes":0},
{"name":"dogs","count":0,"bytes":0},
{"name":"elaine","count":0,"bytes":0},
{"name":"george","count":0,"bytes":0},
{"name":"jerry","count":0,"bytes":0}]
</computeroutput>
		</screen>
        </example>
		<example>
            <title>cURL List Storage Container (XML output)</title>
            <screen>
<command>curl</command> <option>–X GET</option> <option>-D</option> - \
    <option>-H "X-Auth-Token: fc81aaa6-98a1-9ab0-94ba-aba9a89aa9ae"</option> \
    <uri>https://storage.swiftdrive.com/v1/CF_xer7_343?format=xml</uri>
            </screen>
            <screen>
<computeroutput>				
HTTP/1.1 200 OK
X-Account-Object-Count: 0
X-Account-Bytes-Used: 0
X-Account-Container-Count: 5
Accept-Ranges: bytes
Content-Length: 479
Content-Type: application/xml; charset=utf-8
X-Trans-Id: tx5e5685a15d0b406799b6a425b1150e4c
Date: Mon, 07 Nov 2011 19:17:38 GMT

&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;account name="AUTH_a23f73d2-abfb-4656-af94-32ddec35dab8">
&lt;container>&lt;name>cosmo&lt;/name>&lt;count>0&lt;/count>&lt;bytes>0&lt;/bytes>&lt;/container>
&lt;container>&lt;name>dogs&lt;/name>&lt;count>0&lt;/count>&lt;bytes>0&lt;/bytes>&lt;/container>
&lt;container>&lt;name>elaine&lt;/name>&lt;count>0&lt;/count>&lt;bytes>0&lt;/bytes>&lt;/container>
&lt;container>&lt;name>george&lt;/name>&lt;count>0&lt;/count>&lt;bytes>0&lt;/bytes>&lt;/container>
&lt;container>&lt;name>jerry&lt;/name>&lt;count>0&lt;/count>&lt;bytes>0&lt;/bytes>&lt;/container>
&lt;/account>
</computeroutput>
			</screen>
        </example>
		<para>The remainder of the examples in this document will use the standard, non-serialized output but all operations accept the format argument.  You might notice that when you use one of the formats, you get more information about the containers.  That's the per-container metadata, which is covered in the next section.</para>
	</section>

</chapter>
